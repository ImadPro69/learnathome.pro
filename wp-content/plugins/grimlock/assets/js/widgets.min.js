(()=>{"use strict";var e;e=jQuery,window.grimlock||(window.grimlock={}),window.grimlock.widgets||(window.grimlock.widgets={}),window.grimlock.widgets.uploadMedia=function(t){var i,a;void 0===i?((i=wp.media.frames.file_frame=wp.media({title:grimlock_widgets.frame_title,button:{text:grimlock_widgets.button_text},multiple:!1})).on("select",(function(){if(a=i.state().get("selection").first().toJSON(),0<e.trim(a.url).length){var n=e(t.target).parents(".grimlock_section_widget-image");n.find(".attachment-media-view").addClass(["attachment-media-view-image","landscape"].join(" ")),n.find(".placeholder").addClass("hidden"),n.find(".thumbnail").children("img").attr("src",a.url).parent().removeClass("hidden"),n.find(".upload-actions").addClass("hidden"),n.find(".remove-actions").removeClass("hidden"),n.find(".attachment-media-src").val(a.id).change()}})),i.open()):i.open()},window.grimlock.widgets.removeMedia=function(t){var i=e(t.target).parents(".grimlock_section_widget-image");i.find(".attachment-media-view").removeClass(["attachment-media-view-image","landscape"].join(" ")),i.find(".placeholder").removeClass("hidden"),i.find(".thumbnail").addClass("hidden"),i.find(".upload-actions").removeClass("hidden"),i.find(".remove-actions").addClass("hidden"),i.find(".attachment-media-src").val("").change()},window.grimlock.widgets.init=function(t){var i=function(t,i){if("text"!==t.target.type||_.isUndefined(i))"button"===t.target.type&&e(t.target).change();else{var a=e(t.target).data("tmp"),n={color:i.color._color,alpha:i.color._alpha};_.isEqual(a,n)||(e(t.target).data("tmp",n),_.isUndefined(a)||e(t.target).parents(".wp-picker-container").find("input.wp-picker-clear").change())}};t.find(".grimlock_section_widget-color-picker").wpColorPicker({defaultColor:!1,change:i,clear:i,hide:!0,palettes:!0}),t.find(".grimlock_section_widget-radio-image__buttonset").buttonset();var a=function(){var t=e(this).siblings("span.grimlock_input-range-value-indicator"),i=e(this).data("unit");t.length||(t=e('<span class="grimlock_input-range-value-indicator"></span>'),e(this).after(t)),t.html(e(this).val()+" "+i)};t.find('.grimlock-widget input[type="range"]').each(a),t.find('.grimlock-widget input[type="range"]').on("input change",a);var n=function(e,t,i){var a;return i||(i="AND"),e.forEach((function(e){var o;if(e.length)o=n(e,t,"AND"===i?"OR":"AND");else if(e.field&&e.operator&&void 0!==e.value){var r=t.find('[name$="['+e.field+']"]');if(r.length){r.is('[type="radio"]')&&(r=t.find('[name$="['+e.field+']"]:checked'));var d=r.val();switch(r.is('[type="checkbox"]')&&(d=r.is(":checked")),e.operator){case"===":o=d===e.value;break;case"==":o=d==e.value;break;case"!==":o=d!==e.value;break;case"!=":o=d!=e.value;break;case">":o=d>e.value;break;case">=":o=d>=e.value;break;case"<":o=d<e.value;break;case"<=":o=d<=e.value}}else o=!0}void 0!==o&&(a=void 0===a?o:"AND"===i?a&&o:a||o)})),a},o=function(){var t=e(this);e(this).find("[data-grimlock-widget-conditional-logic]").each((function(){var i=!0,a=e(this).data("grimlock-widget-conditional-logic");a&&a.length&&(i=n(a,t)),i?e(this).show():e(this).hide()}))};t.find(".grimlock-widget").each(o),t.find(".grimlock-widget").on("change",o),e(".grimlock-widget-tabs a").click((function(t){t.preventDefault();var i=e(this).attr("href");e(this).parent().addClass("tabs").siblings("li").removeClass("tabs"),e(this).closest(".grimlock-widget-tabs").siblings(".tabs-panel").hide(),e(i).show()})),t.find('.grimlock-widget [name$="[taxonomy]"]').on("change",(function(){var t=e(this).closest(".grimlock-widget").find('[name$="[parent]"]'),i={action:"grimlock_ajax_terms",taxonomy:e(this).val(),ajax_nonce:grimlock_widgets.ajax_nonce};t.html("<option>Loading...</option>"),t.attr("disabled","disabled"),jQuery.post(ajaxurl,i,(function(e){t.attr("disabled",!1),t.html(e)}))}));var r=function(){var t=e(this);t.select2({width:"100%",placeholder:"Loading..."});var i=t.data("grimlock-widget-post-type");if("string"==typeof i&&i.match(/^{.+}$/g)){var a=i.slice(1,i.length-1),n=t.closest(".grimlock-widget").find('[name$="['+a+']"]');i=n.val(),n.one("change",(function(){t.val(null).trigger("change"),r.call(t)}))}i&&e.get(grimlock_widgets.rest_url+"types/"+i,{},(function(i){i&&i.rest_base&&t.select2({width:"100%",closeOnSelect:!1,placeholder:"Select...",ajax:{url:grimlock_widgets.rest_url+i.rest_base,dataType:"json",delay:250,data:function(e){return e.term?{search:e.term}:""},processResults:function(t){return t||t.length?{results:e.map(t,(function(e){return{id:e.id,text:e.title.rendered}}))}:{results:[]}},cache:!0}})}))};t.find(".grimlock-widget .grimlock-widget-post-select").each(r);var d=function(){var t=e(this);t.select2({width:"100%",placeholder:"Loading..."});var i=t.data("grimlock-widget-taxonomy");if("string"==typeof i&&i.match(/^{.+}$/g)){var a=i.slice(1,i.length-1),n=t.closest(".grimlock-widget").find('[name$="['+a+']"]');i=n.val(),n.one("change",(function(){t.val(null).trigger("change"),d.call(t)}))}i&&e.get(grimlock_widgets.rest_url+"taxonomies/"+i,{},(function(i){i&&i.rest_base&&t.select2({width:"100%",closeOnSelect:!1,placeholder:"Select...",ajax:{url:grimlock_widgets.rest_url+i.rest_base,dataType:"json",delay:250,data:function(e){return e.term?{search:e.term}:""},processResults:function(t){return t||t.length?{results:e.map(t,(function(e){return{id:e.id,text:e.name}}))}:{results:[]}},cache:!0}})}))};t.find(".grimlock-widget .grimlock-widget-term-select").each(d)},e(document).ready((function(){e(document).on("click",".grimlock_section_widget-image .upload-button",(function(e){e.preventDefault(),window.grimlock.widgets.uploadMedia(e)})),e(document).on("click",".grimlock_section_widget-image .remove-button",(function(e){e.preventDefault(),window.grimlock.widgets.removeMedia(e)})),window.grimlock.widgets.init(e("#wp_inactive_widgets, #widgets-right")),e(document).on("widget-added",(function(e,t){window.grimlock.widgets.init(t)})),e(document).on("widget-updated",(function(e,t){window.grimlock.widgets.init(t)}))}))})();